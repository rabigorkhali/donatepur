name: Laravel CI/CD

on:
  push:
    branches:
      - live  # Change this to your project's main branch

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [16.x]

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Pull Latest Changes
        run: git pull origin live
        
      # - name: Run Tests
      #   run: vendor/bin/phpunit

  deploy:
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to Production
        run: |
            # Set up the SSH key for authentication
            echo "$SSH_PRIVATE_KEY" > deploy_key
            chmod 600 deploy_key
            ssh -i deploy_key donatepu@141.95.99.203 'cd /home/donatepu/public_html && git pull origin live'
            echo "Deployment to production completed successfully"
        env:
            SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}

    # deploy:
    #   runs-on: ubuntu-latest
    #   needs: build
    #   steps:
    #     - name: Deploy to Production
    #       run: |
    #         # Set up the SSH key for authentication
    #         echo "$SSH_PRIVATE_KEY" > deploy_key
    #         chmod 600 deploy_key
    #         ssh -i deploy_key donatepu@141.95.99.203 'cd /home/donatepu/public_html && git pull origin live'
    #         echo "Deployment to production completed successfully"
    #       env:
    #         SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}

